const path=require("path"),fs=require("fs");let{rpath,rkey}=require(path.join(__dirname,"/config")),$=require(path.join(__dirname,"/config"));module.exports=function(){document.querySelector(".gil__to").addEventListener("dblclick",function(){this.style.display="none",document.querySelector(".gih__to").style.display="flex"}),document.querySelector(".gil__from").addEventListener("dblclick",function(){this.style.display="none",document.querySelector(".gih__from").style.display="flex"}),document.querySelector("#gih__to").addEventListener("dblclick",()=>{for(let a in $.db){let b=Object.keys($.db[a])+"",c=$._fs.getPreset()+"";if(b==c)for(let b in $.db[a])return(document.querySelector(".gih__to").style.display="none",document.querySelector(".gil__to").style.display="flex",""===document.querySelector("#gih__to").value.replace(/\s/g,""))?($._fs.createNotice("\u041F\u043E\u043B\u0435 \u043D\u0435 \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C"),document.querySelector("#gih__to").value="",!1):($.db[a][b].pathTo=document.querySelector("#gih__to").value.trim(),$._fs.setPathTo(document.querySelector("#gih__to").value.trim()),$._fs.updateDB($.db),fs.writeFileSync(path.join(__dirname,rpath.db),JSON.stringify($.db)),document.querySelector(".home__to").innerHTML=document.querySelector("#gih__to").value.trim(),document.querySelector(".global__to").value=document.querySelector("#gih__to").value,document.querySelector("#gih__to").value="",!1)}}),document.querySelector("#gih__from").addEventListener("dblclick",()=>{for(let a in $.db){let b=Object.keys($.db[a])+"",c=$._fs.getPreset()+"";if(b==c)for(let b in $.db[a])return(document.querySelector(".gih__from").style.display="none",document.querySelector(".gil__from").style.display="flex",""===document.querySelector("#gih__from").value.replace(/\s/g,""))?($._fs.createNotice("\u041F\u043E\u043B\u0435 \u043D\u0435 \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C"),document.querySelector("#gih__from").value="",!1):($.db[a][b].pathFrom=document.querySelector("#gih__from").value.trim(),$._fs.setPathFrom(document.querySelector("#gih__from").value.trim()),$._fs.updateDB($.db),fs.writeFileSync(path.join(__dirname,rpath.db),JSON.stringify($.db)),document.querySelector(".home__path").innerHTML=document.querySelector("#gih__from").value.trim(),document.querySelector(".global__from").value=document.querySelector("#gih__from").value,document.querySelector("#gih__from").value="",$._fs.loadFiles(),!1)}}),document.querySelector(".setting-button").addEventListener("click",function(){let a=document.documentElement.getAttribute("theme");"dark"===a?($._fs.setTheme("light"),$.config.theme="light"):($._fs.setTheme("dark"),$.config.theme="dark"),fs.writeFileSync(path.join(__dirname,rpath.config),JSON.stringify($.config))}),document.querySelector(".remember__list").addEventListener("click",function(){const a=this.querySelectorAll("button");if(!a)return!1;let b=[];a.forEach(a=>{a.onclick=()=>{for(let c in $.db){let d=Object.keys($.db[c])+"",e=$._fs.getPreset()+"";if(d==e)for(let d in $.db[c])$.db[c][d].remember.includes(a.dataset.name)&&(b=$.db[c][d].remember.filter(b=>b!==a.dataset.name),$.db[c][d].remember=b)}$._fs.updateRemember(),$._fs.updateDB($.db),fs.writeFileSync(path.join(__dirname,rpath.db),JSON.stringify($.db))}})}),document.querySelector(".remember__apply").addEventListener("click",function(){const a=document.querySelector("#global__remember");if(""===a.value.trim())alert("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0444\u0430\u0439\u043B");else for(let b in $.db){let c=Object.keys($.db[b])+"",d=$._fs.getPreset()+"";if(c==d)for(let c in $.db[b])$.db[b][c].remember.includes(a.value)?alert("\u0422\u0430\u043A\u043E\u0439 \u0444\u0430\u0439\u043B \u0437\u0430\u043F\u0438\u0441\u0430\u043D"):($.db[b][c].remember.push(a.value),a.value="",$._fs.updateDB($.db),fs.writeFileSync(path.join(__dirname,rpath.db),JSON.stringify($.db)),$._fs.updateRemember())}}),document.querySelector(".bth__preset-save").addEventListener("click",function(){let a=document.querySelector("#preset-from"),b=document.querySelector("#preset-to"),c=document.querySelector("#preset-name");if(""!==a.value.trim()||""!==b.value.trim()||""!==c.value.trim()){let d=rkey(20),e=new Map([[`${d}`,{name:c.value,pathFrom:a.value,pathTo:b.value,typeFiles:"",sizeFiles:"",wordLeft:"",wordRight:"",changed:"",remember:[]}]]);$.db.push(Object.fromEntries(e)),fs.writeFileSync(path.join(__dirname,rpath.db),JSON.stringify($.db)),document.querySelector(".preset__list").innerHTML+=`
                    <div class="preset__item-wrap">
                        <label class="preset__item" for="${d}">
                            <input type="radio" name="preset" id="${d}" value="${c.value}"
                            data-from="${a.value}"
                            data-to="${b.value}"
                            data-id="${d}"
                            data-remember=""
                            />
                            <span class="">${c.value}</span>
                        </label>
                        <div>
                            <i class="fa-duotone fa-wrench setting__preset-${d}"></i>
                            ${"start"===d?"":"<i class=\"fa-duotone fa-trash\"></i>"}
                        </div>
                    </div>
                `,document.querySelector(".preset__from-pop").style.display="none",document.querySelector(".preset__from-container").style.display="none",$._fs.updateDB($.db),a.value="",b.value="",c.value=""}}),document.querySelector(".kit__popup").addEventListener("click",function(){const a=this.querySelectorAll(".fa-wrench");return!!a&&void a.forEach(a=>{a.onclick=()=>{let b=a.parentNode.parentNode.querySelector("input"),c={};for(let a in $.db){let d=Object.keys($.db[a])[0]+"";for(let e in $.db[a])if(d===b.dataset.id){c.name=$.db[a][e].name,c.pathFrom=$.db[a][e].pathFrom,c.pathTo=$.db[a][e].pathTo,c.typeFiles=$.db[a][e].typeFiles,c.sizeFiles=$.db[a][e].sizeFiles,c.wordLeft=$.db[a][e].wordLeft,c.wordRight=$.db[a][e].wordRight;break}}document.querySelector("#preset-id").value=b.dataset.id,document.querySelector("#change-name").value=c.name,document.querySelector("#change-from").value=c.pathFrom,document.querySelector("#change-to").value=c.pathTo,document.querySelector("#change-file").value=c.typeFiles,document.querySelector("#change-name-from").value=c.wordLeft,document.querySelector("#change-name-to").value=c.wordRight,document.querySelector("#change-size").value=c.sizeFiles,document.querySelectorAll(".tb__popup").forEach(a=>a.style.display="none"),document.querySelectorAll(".tb__span").forEach(a=>a.classList.remove("tb__bth-active")),document.querySelector(".change__from-pop").style.display="flex",document.querySelector(".change__from-container").style.display="block"}})}),document.querySelector(".bth__change-save").addEventListener("click",function(a){a.preventDefault();let b=document.querySelector("#preset-id").value,c=document.querySelector("#change-name").value,d=document.querySelector("#change-from").value,e=document.querySelector("#change-to").value,f=document.querySelector("#change-file").value,g=document.querySelector("#change-name-from").value,h=document.querySelector("#change-name-to").value,i=document.querySelector("#change-size").value;for(let j in $.db){let a=Object.keys($.db[j])[0]+"";for(let k in $.db[j])if(a===b){$.db[j][k].name=c,$.db[j][k].pathFrom=d,$.db[j][k].pathTo=e,$.db[j][k].typeFiles=f,$.db[j][k].sizeFiles=i,$.db[j][k].wordLeft=g,$.db[j][k].wordRight=h,fs.writeFileSync(path.join(__dirname,rpath.db),JSON.stringify($.db));break}}$._fs.createNotice("\u0414\u0430\u043D\u043D\u044B\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B"),document.querySelector(".change__from-pop").style.display="none",document.querySelector(".change__from-container").style.display="none",document.querySelector("#preset-id").value="",document.querySelector("#change-name").value="",document.querySelector("#change-from").value="",document.querySelector("#change-to").value="",document.querySelector("#change-file").value="",document.querySelector("#change-name-from").value="",document.querySelector("#change-name-to").value="",document.querySelector("#change-size").value=""}),document.querySelector(".bth__letter-save").addEventListener("click",function(a){a.preventDefault();let b=document.querySelector("#preset__letter-from").value,c=$._fs.getPreset();for(let d in $.db){let a=Object.keys($.db[d])[0]+"";for(let e in $.db[d])if(a===c)return $.db[d][e].pathFrom=b,document.querySelector("#preset__letter-name").value="",document.querySelector(".preset__letter-pop").style.display="none",document.querySelector(".preset__letter-container").style.display="none",fs.writeFileSync(path.join(__dirname,rpath.db),JSON.stringify($.db)),$._fs.loadFiles(),!1}}),document.querySelector(".preset__list").addEventListener("click",function(){const a=this.querySelectorAll("input");if(!a)return!1;[].forEach.call(a,a=>{a.onclick=()=>{$.tmpf.id=a.dataset.id,$.tmpf.from=a.dataset.from,$.tmpf.to=a.dataset.to,$.tmpf.remember=a.dataset.remember,$.config.ActivePreset=a.dataset.id,$._fs.setPreset($.tmpf.id,$.tmpf.from,$.tmpf.to,$.tmpf.remember),fs.writeFileSync(path.join(__dirname,rpath.config),JSON.stringify($.config))}});const b=this.querySelectorAll(".trash__preset");[].forEach.call(b,a=>{a.onclick=()=>{let b=a.dataset.id,c=$._fs.getPreset(),d=[];if(b===c)alert("\u0414\u0430\u043D\u043D\u044B\u0439 \u043F\u0440\u0435\u0441\u0435\u0442 \u0430\u043A\u0442\u0438\u0432\u0435\u043D");else{for(let a in $.db){let c=Object.keys($.db[a])+"";c!==b&&d.push($.db[a])}$.db.length=0,$.db.push(...d),$._fs.updateDB($.db),$._fs.updatePreset(),fs.writeFileSync(path.join(__dirname,rpath.db),JSON.stringify($.db))}}})}),document.querySelector(".file__thead input").addEventListener("click",function(){$.files_=[],$._fs.cleanActiveList();let a=this.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelectorAll(".file__tbody input");a.forEach(a=>{this.checked?(a.setAttribute("checked","true"),a.checked=!0,$.files_.push({id:a.dataset.id,name:a.dataset.name,path:a.dataset.path})):(a.removeAttribute("checked"),a.checked=!1)});let b=Object.keys($.files_).length;0<b?(document.querySelector(".search__result").innerHTML=`Выбрано ${b} файлов`,document.querySelector(".global__button-tran").style.display="flex"):(document.querySelector(".search__result").innerHTML=`Найдено ${$._fs.getCountFiles()} файлов`,document.querySelector(".global__button-tran").style.display="none")}),document.querySelector(".file__tbody").addEventListener("click",function(){const a=this.querySelectorAll("input");if(!a)return!1;$._fs.cleanActiveList();let b=document.querySelector(".file__table input");b.checked&&(b.removeAttribute("checked"),b.checked=!1),a.forEach(a=>{a.onclick=()=>{let a=this.querySelectorAll("input:checked");$.files_=[].map.call(a,a=>({id:a.dataset.id,name:a.dataset.name,path:a.dataset.path}))}});let c=Object.keys($.files_).length;c===$._fs.getCountFiles()&&(b.setAttribute("checked","true"),b.checked=!0),0<c?(document.querySelector(".search__result").innerHTML=`Выбрано ${c} файлов`,document.querySelector(".global__button-tran").style.display="flex"):(document.querySelector(".search__result").innerHTML=`Найдено ${$._fs.getCountFiles()} файлов`,document.querySelector(".global__button-tran").style.display="none")})};